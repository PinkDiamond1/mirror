var poolTimer,detectMetamask=!1,metamaskConnected=!1,userAddress="",stbzPrice=new BigNumber(0),ethPrice=new BigNumber(0),TVL=new BigNumber(0),operatorAddress="",wethAddress="0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",stbzAddress="0x2C110867CA90e43D372C1C2E92990B00EA32818b",wethSTBZPool="0x835a1BcA3e5da0752dD73BD3f89AC0357fD34943",contract_viewallowance="dd62ed3e",contract_approve="095ea7b3",contract_totalsupply="18160ddd",contract_balanceof="70a08231",contract_getreserves="0902f1ac",contract_token0address="0dfe1681",contract_tokenprice="7b1b1de6",contract_deposit="e2bbb158",contract_staking_deposit="a694fc3a",contract_exit="2af9cc41",contract_staking_exit="7f8661a1",contract_claimReward="1c4b774b",contract_staking_claimReward="3d18b912",contract_poolBalance="351e7cb3",contract_staking_poolBalance="68abb5e0",contract_poolSize="dd034779",contract_staking_poolSize="4ec18db9",contract_rewardEarned="cdfa2c36",contract_staking_rewardEarned="008cc262",contract_rewardRate="cea01962",contract_staking_rewardRate="7b0a47ee",contract_circsupply="9358928b",contract_claimTreasury="379607f5",contract_treasuryBalance="9105d748",contract_mint_week="19597a56",contract_last_oracle="0c89a0f0",contract_period_end="0962c4f9",contract_rebalance_pools="882229f3",targetNetwork=42161,poolList=[],pricesList=[],treasuryList=[],poolRotation=0;function loadPoolList(){}function loadInactivePoolList(){}function checkMetaMaskExist(){void 0!==window.ethereum&&(detectMetamask=!0,null==getCookie("metamask")?$("#metamask_interactive").html("Connect Wallet"):0==metamaskConnected&&enableMetaMask())}async function enableMetaMask(){const e=await ethereum.request({method:"eth_requestAccounts"});if(e){var t=await ethereum.request({method:"eth_chainId"});if(0!=(t=new BigNumber("0x"+t.substring(2))).comparedTo(targetNetwork))return 0==t.comparedTo(56)?void window.location.replace("../../"):0==t.comparedTo(1)?(userAddress=e[0],$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),$("#connection_text").html('Switch network from Ethereum network to <a href="https://developer.offchainlabs.com/docs/mainnet#connect-your-wallet" target="_blank">Arbitrum One</a> network<br><a style="font-size: 12px;" href="../deprecated-v1/">View deprecated Ethereum pools</a>'),void ethereum.on("chainChanged",function(e){location.reload()})):void alert("This application requires the Arbitrum One network, please switch it in your MetaMask UI.");userAddress=e[0],metamaskConnected=!0,setCookie("metamask","active",0),$("#loading_panel").hide(),$("#data_panel").show(),getPrices(),$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),ethereum.on("accountsChanged",function(e){userAddress=e[0],$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),location.reload()}),ethereum.on("chainChanged",function(e){location.reload()})}}function metamaskButtonClick(){if(0==detectMetamask)window.open("https://metamask.io/","_blank");else 1==detectMetamask&&0==metamaskConnected&&enableMetaMask()}function padleftzero(e,t){return(e=e.toString()).length<t?padleftzero("0"+e,t):e}function padrightzero(e,t){return(e=e.toString()).length<t?padrightzero(e+"0",t):e}function showInactivePools(){$("#inactive_pool_controller").html("INACTIVE POOLS"),$("#inactive_pool_container").show(),0==poolRotation&&TVL.comparedTo(0)>0?(poolRotation=poolList.length,loadInactivePoolList(),clearTimeout(poolTimer),poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4),refreshPoolData(!1)):loadInactivePoolList()}function getPrices(){var e=!1;0==poolList.length&&(e=!0,loadPoolList());$.get("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd",function(t){t&&(ethPrice=new BigNumber(t.ethereum.usd),(pricesList={}).ETH=new BigNumber(ethPrice),matchPoolToPrices(),1==e&&refreshPoolData(!0))})}function matchPoolToPrices(){if(0!=poolList.length)for(var e=0;e<poolList.length;e++)"zs-tsBTC"==poolList[e].units?poolList[e].usdPrice=pricesList.BTC:"zs-ETH"==poolList[e].units?poolList[e].usdPrice=pricesList.ETH:"zs-SGR"==poolList[e].units?poolList[e].usdPrice=pricesList.SGR:"zs-BTC"==poolList[e].units&&(poolList[e].usdPrice=pricesList.BTC)}async function getTotalSupply(){const e=[{to:stbzAddress,data:"0x"+contract_totalsupply},"latest"];await ethereum.request({method:"eth_call",params:e}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64));o=o.div(new BigNumber(10).pow(18)),$("#total_supply").html(o.toFormat(2))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}async function getSTBZPrice(){var e=padleftzero(wethSTBZPool.substring(2),64),t=[{to:wethAddress,data:"0x"+contract_balanceof+e},"latest"],o=new BigNumber(0);await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2);o=new BigNumber("0x"+t.substring(0,64)).div(new BigNumber(10).pow(18))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),t=[{to:stbzAddress,data:"0x"+contract_balanceof+e},"latest"];var r=new BigNumber(0);if(await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2);r=new BigNumber("0x"+t.substring(0,64)).div(new BigNumber(10).pow(18))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),0==r.comparedTo(0))return stbzPrice=new BigNumber(0),void $("#stbz_price").html("N/A");stbzPrice=o.times(ethPrice).div(r),$("#stbz_price").html("$"+stbzPrice.toFormat(2))}async function calculateUnderlyingInterest(e){var t=poolList[e].underlyingInterestMethod,o=poolList[e].underlyingInterestData,r=poolList[e].panel;if("strategy"==t){var a,n,i,s=new BigNumber(o),l=poolList[e].poolToken;if(await ethereum.request({method:"eth_blockNumber",params:[]}).then(e=>{var t=e.substring(2);a=new BigNumber("0x"+t.substring(0,64))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),a.minus(6527).comparedTo(s)<0)return;n=[{to:l,data:"0x"+contract_tokenprice},"0x"+a.toString(16)],await ethereum.request({method:"eth_call",params:n}).then(e=>{var t=e.substring(2);i=new BigNumber("0x"+t.substring(0,64))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),n=[{to:l,data:"0x"+contract_tokenprice},"0x"+a.minus(45689).toString(16)],await ethereum.request({method:"eth_call",params:n}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64)),a=i.div(o).minus(1).div(7).times(100).times(365);a.comparedTo(.001)>0?$("#panel_"+r+"_interest_link").html(a.dp(2).toString(10)+"% &#9654;"):$("#panel_"+r+"_interest_link").html("N/A &#9654;")}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}else"none"==t&&$("#panel_"+r+"_interest_link").html("0% &#9654;")}function checkAllowance(e){var t=poolList[e].panel;if("none"==$("#panel_"+t+"_action_buttons").css("display")&&"none"==$("#panel_"+t+"_unlock_button").css("display")||1==$("#panel_"+t+"_unlock_inner_button").prop("disabled")){var o=poolList[e].poolToken,r=padleftzero(userAddress.substring(2),64),a=padleftzero(operatorAddress.substring(2),64);const n=[{to:o,data:"0x"+contract_viewallowance+r+a},"latest"];ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2);new BigNumber("0x"+o.substring(0,64)).comparedTo(1)<0?$("#panel_"+t+"_unlock_button").show():($("#panel_"+t+"_unlock_button").hide(),$("#panel_"+t+"_action_buttons").show())}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}}async function refreshPoolData(e){if(0==poolRotation)await getTotalSupply(),await getSTBZPrice(),TVL=new BigNumber(0),null!=poolTimer&&clearTimeout(poolTimer),poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4);else if(1==e)return null!=poolTimer&&clearTimeout(poolTimer),void(poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4));if(0!=poolList.length){checkAllowance(poolRotation);var t,o,r,a=poolRotation,n=poolList[a].panel;if(0==poolList[a].stbzPool){var i=new BigNumber(poolList[a].poolID).toString(16);i=padleftzero(i,64),t=[{to:operatorAddress,data:"0x"+contract_poolSize+i},"latest"]}else t=[{to:stakingAddress,data:"0x"+contract_staking_poolSize},"latest"];await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2);o=(o=new BigNumber("0x"+t.substring(0,64))).div(new BigNumber(10).pow(poolList[a].decimals)),r=2,o.comparedTo(.01)<0&&(r=8),$("#panel_"+n+"_poolsize").html(o.dp(r).toString(10)+" "+poolList[a].units)}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))});var s,l=padleftzero(userAddress.substring(2),64);t=0==poolList[a].stbzPool?[{to:operatorAddress,data:"0x"+contract_poolBalance+i+l},"latest"]:[{to:stakingAddress,data:"0x"+contract_staking_poolBalance+l},"latest"],await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2);s=(s=new BigNumber("0x"+t.substring(0,64))).div(new BigNumber(10).pow(poolList[a].decimals)),$("#panel_"+n+"_mybalance").html(s.dp(r).toString(10)+" "+poolList[a].units),s.comparedTo(0)<=0?"none"!=$("#panel_"+n+"_withdraw_button").css("display")&&($("#panel_"+n+"_withdraw_button").hide(),$("#panel_"+n+"_claim_button").hide()):"none"==$("#panel_"+n+"_withdraw_button").css("display")&&($("#panel_"+n+"_withdraw_button").show(),$("#panel_"+n+"_claim_button").show())}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))});var c=new BigNumber(1);1==poolList[a].proxy&&(t=[{to:poolList[a].poolToken,data:"0x"+contract_tokenprice},"latest"],await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2);c=(c=new BigNumber("0x"+t.substring(0,64))).div(new BigNumber(10).pow(18));var i=s.times(c);$("#panel_"+n+"_value").html(i.dp(r).toString(10)+" "+poolList[a].underlyingUnits);var l=o.times(c).times(poolList[a].usdPrice);console.log("Pool "+a+" usd value: "+l.dp(2).toString(10)),TVL=TVL.plus(l),poolList.length}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})),t=0==poolList[a].stbzPool?[{to:operatorAddress,data:"0x"+contract_rewardEarned+i+l},"latest"]:[{to:stakingAddress,data:"0x"+contract_staking_rewardEarned+l},"latest"],await ethereum.request({method:"eth_call",params:t}).then(e=>{var o=e.substring(2),r=new BigNumber("0x"+o.substring(0,64));r=r.div(new BigNumber(10).pow(18)),0==poolList[a].stbzPool?($("#panel_"+n+"_rewardbalance").html(r.dp(4).toString(10)+" STBZ"),t=[{to:operatorAddress,data:"0x"+contract_rewardRate+i},"latest"]):($("#panel_"+n+"_rewardbalance").html(r.dp(8).toString(10)+" WETH"),t=[{to:stakingAddress,data:"0x"+contract_staking_rewardRate},"latest"])}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),await ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2),r=new BigNumber("0x"+t.substring(0,64));if("LP"!=poolList[a].units){r=r.div(new BigNumber(10).pow(18)),r=0==poolList[a].stbzPool?r.times(stbzPrice):r.times(ethPrice),o.comparedTo(0)>0&&(1==poolList[a].proxy&&0==(o=o.times(poolList[a].usdPrice).times(c)).comparedTo(0)&&(o=new BigNumber(1)),0==poolList[a].proxy&&0==poolList[a].stbzPool&&(console.log("Pool Normal "+a+" usd value: "+o.dp(2).toString(10)),TVL=TVL.plus(o)),0==poolList[a].stbzPool?r=r.div(o):(r=r.div(o.times(stbzPrice)),r=new BigNumber(0)));var i=r.times(new BigNumber(86400)),s=2;(i=i.times(100)).comparedTo("0.01")<0&&(s=8),$("#panel_"+n+"_dpy").html(i.dp(s).toString(10)+"%");var l=i.times(365);s=2,l.comparedTo("0.01")<0&&(s=8),$("#panel_"+n+"_apr").html(l.dp(s).toString(10)+"%");var d=l.div(100);s=2,(d=d.div(52).plus(1).pow(52).minus(1).times(100)).comparedTo("0.01")<0&&(s=8);var p=d.dp(s).toString(10)+"%";if(d.comparedTo("1000000")>0&&(p="> 1000000%"),1==poolList[a].proxy){var u="---";$("#panel_"+n+"_interest_link").length>0&&(u=$("#panel_"+n+"_interest_link").html()),$("#panel_"+n+"_apy").html(p+" + <a id='panel_"+n+"_interest_link' href='wrap/' style='color: rgb(40,200,40);'>"+u+"</a>"),calculateUnderlyingInterest(a)}else $("#panel_"+n+"_apy").html(p);poolList.length,++poolRotation>=poolList.length?(getPrices(),poolRotation=0):window.setTimeout(function(){refreshPoolData(!1)},500)}else getLPTokenDPY(a,o,r)}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}else $("#tvl").html("N/A")}function getLPTokenDPY(e,t,o){const r=[{to:poolList[e].poolToken,data:"0x"+contract_getreserves},"latest"];ethereum.request({method:"eth_call",params:r}).then(r=>{var a=r.substring(2),n=new BigNumber("0x"+a.substring(0,64)),i=new BigNumber("0x"+a.substring(64,128));const s=[{to:poolList[e].poolToken,data:"0x"+contract_token0address},"latest"];ethereum.request({method:"eth_call",params:s}).then(r=>{var a=r.substring(2).substring(0,64).toLowerCase(),s=padleftzero(wethAddress.substring(2),64).toLowerCase();const l=[{to:poolList[e].poolToken,data:"0x"+contract_totalsupply},"latest"];ethereum.request({method:"eth_call",params:l}).then(r=>{var l=r.substring(2),c=new BigNumber("0x"+l.substring(0,64));if(!(c.comparedTo(0)<=0||ethPrice.comparedTo(0)<=0)){var d=0;a==s?(n=n.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=n.div(i.div(new BigNumber(10).pow(18)))),i=new BigNumber(n)):(i=i.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=i.div(n.div(new BigNumber(10).pow(18)))),n=new BigNumber(i)),d=n.plus(i),c=c.div(new BigNumber(10).pow(18));var p=t.div(c),u=d.times(p);u.comparedTo(0)<=0?u=1:(console.log("LP Pool usd value: "+u.dp(2).toString(10)),TVL=TVL.plus(u));var g=(o=(o=(o=o.div(new BigNumber(10).pow(18))).times(stbzPrice)).div(u)).times(new BigNumber(86400));g=g.times(100),$("#panel_"+poolList[e].panel+"_dpy").html(g.dp(2).toString(10)+"%");var m=g.times(365);$("#panel_"+poolList[e].panel+"_apr").html(m.dp(2).toString(10)+"%");var h=m.div(100);h=h.div(52).plus(1).pow(52).minus(1).times(100),$("#panel_"+poolList[e].panel+"_apy").html(h.dp(2).toString(10)+"%"),poolList.length,++poolRotation>=poolList.length?(getPrices(),poolRotation=0):window.setTimeout(function(){refreshPoolData(!1)},500)}}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function unlockToken(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber(2).pow(256).minus(1),a=operatorAddress.substring(2);1==poolList[t].stbzPool&&(a=stakingAddress.substring(2)),a=padleftzero(a.toLowerCase(),64);var n=r.toString(16);n=padleftzero(n,64),sendETHTransaction([{to:poolList[t].poolToken,gas:"0x186A0",from:userAddress,data:"0x"+contract_approve+a+n}],function(){$("#panel_"+e+"_unlock_inner_button").prop("disabled",!0),$("#panel_"+e+"_unlock_inner_button").html("UNLOCKING "+poolList[t].units)})}function selectMaxOut(e){for(var t,o=0,r=0;r<poolList.length;r++)if(parseInt(poolList[r].panel)==e){o=r;break}if(0==poolList[o].stbzPool){var a=new BigNumber(poolList[o].poolID).toString(16);a=padleftzero(a,64);var n=padleftzero(userAddress.substring(2),64);t=[{to:operatorAddress,data:"0x"+contract_poolBalance+a+n},"latest"]}else{n=padleftzero(userAddress.substring(2),64);t=[{to:stakingAddress,data:"0x"+contract_staking_poolBalance+n},"latest"]}ethereum.request({method:"eth_call",params:t}).then(t=>{var r=t.substring(2),a=new BigNumber("0x"+r.substring(0,64));a=a.div(new BigNumber(10).pow(poolList[o].decimals)),$("#panel_"+e+"_amount").val(a.toString(10))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function selectMaxIn(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=padleftzero(userAddress.substring(2),64);const a=[{to:poolList[t].poolToken,data:"0x"+contract_balanceof+r},"latest"];ethereum.request({method:"eth_call",params:a}).then(o=>{var r=o.substring(2),a=new BigNumber("0x"+r.substring(0,64));a=a.div(new BigNumber(10).pow(poolList[t].decimals)),$("#panel_"+e+"_amount").val(a.toString(10))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function deposit(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber($("#panel_"+e+"_amount").val());if(!(r.isNaN()||r.comparedTo(0)<=0)){var a,n=(r=r.times(new BigNumber(10).pow(poolList[t].decimals))).toString(16);if(n=padleftzero(n,64),0==poolList[t].stbzPool){var i=new BigNumber(poolList[t].poolID).toString(16);i=padleftzero(i,64),a=[{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_deposit+i+n}]}else a=[{to:stakingAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_staking_deposit+n}];sendETHTransaction(a,null)}}function withdraw(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber($("#panel_"+e+"_amount").val());if(!(r.isNaN()||r.comparedTo(0)<=0)){var a,n=(r=r.times(new BigNumber(10).pow(poolList[t].decimals))).toString(16);if(n=padleftzero(n,64),0==poolList[t].stbzPool){var i=new BigNumber(poolList[t].poolID).toString(16);i=padleftzero(i,64),a=[{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_exit+i+n}]}else a=[{to:stakingAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_staking_exit+n}];sendETHTransaction(a,null)}}function claimReward(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber(poolList[t].poolID).toString(16);r=padleftzero(r,64),sendETHTransaction(0==poolList[t].stbzPool?[{to:operatorAddress,gas:"0x30D40",from:userAddress,data:"0x"+contract_claimReward+r}]:[{to:stakingAddress,gas:"0x30D40",from:userAddress,data:"0x"+contract_staking_claimReward}],null)}async function sendETHTransaction(e,t){var o=await ethereum.request({method:"eth_chainId"});0==(o=new BigNumber("0x"+o.substring(2))).comparedTo(targetNetwork)?ethereum.request({method:"eth_sendTransaction",params:e}).then(e=>{console.log("Transaction hash: "+e),t&&t()}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}):alert("This application requires the main network, please switch it in your MetaMask UI.")}function setCookie(e,t,o){var r="";if(o>0){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3),r="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+r+"; path=/; SameSite=Strict"}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var a=o[r];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}function eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}$(window).on("load",function(){checkMetaMaskExist()});