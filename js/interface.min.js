var poolTimer,detectMetamask=!1,metamaskConnected=!1,userAddress="",stbzPrice=0,ethPrice=new BigNumber(0),btcPrice=new BigNumber(0),circulatingSupply=new BigNumber(0),TVL=new BigNumber(0),totalTreasury=new BigNumber(0),operatorAddress="0xEe9156C93ebB836513968F92B4A67721f3cEa08a",wethAddress="0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",stbzAddress="0xB987D48Ed8f2C468D52D6405624EADBa5e76d723",oracleAddress="0x81A363F3C747dbE947b43486Db4C6AA4DC70DDc4",treasuryAddress="0x42Cbe17335ef8d52F8d1e0a261eA2e78E829C56e",stakingAddress="0x8c17bE13e034f7fa2a6496bC83B6010be6305204",contract_viewallowance="dd62ed3e",contract_approve="095ea7b3",contract_totalsupply="18160ddd",contract_balanceof="70a08231",contract_getreserves="0902f1ac",contract_token0address="0dfe1681",contract_tokenprice="7b1b1de6",contract_strategyprice="2e16d54e",contract_deposit="e2bbb158",contract_staking_deposit="a694fc3a",contract_exit="2af9cc41",contract_staking_exit="7f8661a1",contract_claimReward="1c4b774b",contract_staking_claimReward="3d18b912",contract_poolBalance="351e7cb3",contract_staking_poolBalance="68abb5e0",contract_poolSize="dd034779",contract_staking_poolSize="4ec18db9",contract_rewardEarned="cdfa2c36",contract_staking_rewardEarned="008cc262",contract_rewardRate="cea01962",contract_staking_rewardRate="7b0a47ee",contract_circsupply="9358928b",contract_claimTreasury="379607f5",contract_treasuryBalance="9105d748",contract_mint_week="19597a56",contract_last_oracle="0c89a0f0",contract_period_end="0962c4f9",contract_rebalance_pools="882229f3",contract_getPrice="41976e09",targetNetwork=1,poolList=[],stablesPriceList=[],treasuryList=[],poolRotation=0;function loadStablesList(){stablesPriceList.push({poolToken:"0x6B175474E89094C44Da98b954EedeAC495271d0F"}),stablesPriceList.push({poolToken:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"}),stablesPriceList.push({poolToken:"0xdAC17F958D2ee523a2206206994597C13D831ec7"}),stablesPriceList.push({poolToken:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51"})}function loadPoolList(){poolList.push({poolID:0,poolToken:"0xdb28312a8d26d59978d9b86ca185707b1a26725b",units:"LP",decimals:18,panel:"0",proxy:!1,stbzPool:!1}),poolList.push({poolID:14,poolToken:"0x8e769EAA31375D13a1247dE1e64987c28Bed987E",units:"zs-USD",decimals:18,panel:"15",proxy:!0,underlyingUnits:"USD",stbzPool:!1,underlyingInterestMethod:"strategy",underlyingInterestData:11393244,usdPrice:1}),poolList.push({poolID:15,poolToken:"0x739D93f2b116E6aD754e173655c635Bd5D8d664c",units:"zs-BTC",decimals:18,panel:"16",proxy:!0,underlyingUnits:"BTC",stbzPool:!1,underlyingInterestMethod:"strategy",underlyingInterestData:11441662,usdPrice:1}),poolList.push({poolID:20,poolToken:"0x93B97BBb3F65EC39ea6041bF92FA998e5434E858",units:"zs-ETH",decimals:18,panel:"21",proxy:!0,underlyingUnits:"ETH",stbzPool:!1,underlyingInterestMethod:"strategy",underlyingInterestData:11999453,usdPrice:1}),poolList.push({poolID:18,poolToken:"0xD469BB16116443F389EfEF407D73EF7Ab0Ad96Ce",units:"zs-FRAX",decimals:18,panel:"19",proxy:!0,underlyingUnits:"FRAX",stbzPool:!1,underlyingInterestMethod:"strategy",underlyingInterestData:11757442,usdPrice:1}),poolList.push({poolID:19,poolToken:"0x27E8d93D27f55130B1870d8EF2BCE847C08A8191",units:"zs-UST",decimals:18,panel:"20",proxy:!0,underlyingUnits:"UST",stbzPool:!1,underlyingInterestMethod:"strategy",underlyingInterestData:11939455,usdPrice:1}),poolList.push({poolID:21,poolToken:"0xc79376E4E60c4f83c933e0E0cD5B87Fb1c9848F7",units:"zs-XUSD",decimals:18,panel:"22",proxy:!0,underlyingUnits:"XUSD",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:12094507,usdPrice:1}),poolList.push({poolID:-1,poolToken:stbzAddress,units:"STBZ",decimals:18,panel:"9",proxy:!1,stbzPool:!0})}function loadInactivePoolList(){poolList.push({poolID:16,poolToken:"0xfea2468C55E80aB9487f6E6189C79Ce31E1f9Ea7",units:"zs-SGR",decimals:18,panel:"17",proxy:!0,underlyingUnits:"SGR",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:11564062,usdPrice:1}),poolList.push({poolID:17,poolToken:"0x939D73E26138f4B483368F96d17D2B4dCc5bc84f",units:"zs-BMSGR",decimals:18,panel:"18",proxy:!0,underlyingUnits:"BMSGR",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:11660983,usdPrice:1}),poolList.push({poolID:10,poolToken:"0x4dEaD8338cF5cb31122859b2Aec2b60416D491f0",units:"zpa-USDC",decimals:6,panel:"11",proxy:!0,underlyingUnits:"USDC",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",usdPrice:1}),poolList.push({poolID:13,poolToken:"0xfa8c04d342FBe24d871ea77807b1b93eC42A57ea",units:"zpa-DAI",decimals:18,panel:"14",proxy:!0,underlyingUnits:"DAI",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0x6B175474E89094C44Da98b954EedeAC495271d0F",usdPrice:1}),poolList.push({poolID:11,poolToken:"0x6B2e59b8EbE61B5ee0EF30021b7740C63F597654",units:"zpa-USDT",decimals:6,panel:"12",proxy:!0,underlyingUnits:"USDT",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0xdAC17F958D2ee523a2206206994597C13D831ec7",usdPrice:1}),poolList.push({poolID:12,poolToken:"0x89Cc19cece29acbD41F931F3dD61A10C1627E4c4",units:"zpa-sUSD",decimals:18,panel:"13",proxy:!0,underlyingUnits:"sUSD",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51",usdPrice:1}),poolList.push({poolID:3,poolToken:"0xdAC17F958D2ee523a2206206994597C13D831ec7",units:"USDT",decimals:6,panel:"3",proxy:!1,stbzPool:!1}),poolList.push({poolID:4,poolToken:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51",units:"sUSD",decimals:18,panel:"4",proxy:!1,stbzPool:!1}),poolList.push({poolID:1,poolToken:"0x6B175474E89094C44Da98b954EedeAC495271d0F",units:"DAI",decimals:18,panel:"1",proxy:!1,stbzPool:!1}),poolList.push({poolID:8,poolToken:"0x38ea93D59cc7B83DA7847E9a22eACDDc0751Af77",units:"za-DAI",decimals:18,panel:"8",proxy:!0,underlyingUnits:"DAI",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0x6B175474E89094C44Da98b954EedeAC495271d0F",usdPrice:1}),poolList.push({poolID:6,poolToken:"0xd1C790B9B2Ac49639f99a88B0a5991dFa6cD2C14",units:"za-USDT",decimals:6,panel:"6",proxy:!0,underlyingUnits:"USDT",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:"0xdAC17F958D2ee523a2206206994597C13D831ec7",usdPrice:1}),poolList.push({poolID:9,poolToken:"0x2212F60BC949cF09a8BCCcA29038014094A70231",units:"zs-DAI",decimals:18,panel:"10",proxy:!0,underlyingUnits:"DAI",stbzPool:!1,underlyingInterestMethod:"none",underlyingInterestData:11393244,usdPrice:1})}function loadTreasuryTokens(){treasuryList.push({token:"0x6B175474E89094C44Da98b954EedeAC495271d0F",units:"DAI",decimals:18,tokenID:0,lastBalance:0,isStable:!0}),treasuryList.push({token:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",units:"USDC",decimals:6,tokenID:1,lastBalance:0,isStable:!0}),treasuryList.push({token:"0xdAC17F958D2ee523a2206206994597C13D831ec7",units:"USDT",decimals:6,tokenID:2,lastBalance:0,isStable:!0}),treasuryList.push({token:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51",units:"sUSD",decimals:18,tokenID:3,lastBalance:0,isStable:!0}),treasuryList.push({token:"0x5dbcF33D8c2E976c6b560249878e6F1491Bca25c",units:"yUSD",decimals:18,tokenID:4,lastBalance:0,isStable:!0}),treasuryList.push({token:"0x514910771AF9Ca656af840dff83E8264EcF986CA",units:"LINK",decimals:18,tokenID:5,lastBalance:0,isStable:!1}),treasuryList.push({token:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",units:"wBTC",decimals:8,tokenID:6,lastBalance:0,isStable:!1}),treasuryList.push({token:"0xEB4C2781e4ebA804CE9a9803C67d0893436bB27D",units:"renBTC",decimals:8,tokenID:7,lastBalance:0,isStable:!1}),treasuryList.push({token:"0x49849C98ae39Fff122806C06791Fa73784FB3675",units:"CRVBTC",decimals:18,tokenID:8,lastBalance:0,isStable:!1}),treasuryList.push({token:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",units:"WETH",decimals:18,tokenID:9,lastBalance:0,isStable:!1}),$("#treasury_amount").on("change keyup paste",personalizeTreasury)}function checkMetaMaskExist(){void 0!==window.ethereum&&(1==ethereum.isMetaMask&&(detectMetamask=!0,null==getCookie("metamask")?$("#metamask_interactive").html("Connect MetaMask"):0==metamaskConnected&&enableMetaMask()))}async function enableMetaMask(){const e=await ethereum.request({method:"eth_requestAccounts"});if(e){if(ethereum.chainId||(ethereum.chainId="0x1"),0!=new BigNumber("0x"+ethereum.chainId.substring(2)).comparedTo(targetNetwork))return void alert("This application requires the main network, please switch it in your MetaMask UI.");userAddress=e[0],metamaskConnected=!0,setCookie("metamask","active",0),$("#data_panel").length?($("#loading_panel").hide(),$("#data_panel").show(),getPrices()):getStablecoinPrices(0),$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),ethereum.on("accountsChanged",function(e){userAddress=e[0],$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),location.reload()}),ethereum.on("chainChanged",function(e){location.reload()})}}function metamaskButtonClick(){if(0==detectMetamask)window.open("https://metamask.io/","_blank");else 1==detectMetamask&&0==metamaskConnected&&enableMetaMask()}function padleftzero(e,t){return(e=e.toString()).length<t?padleftzero("0"+e,t):e}function padrightzero(e,t){return(e=e.toString()).length<t?padrightzero(e+"0",t):e}function showInactivePools(){$("#inactive_pool_controller").html("INACTIVE POOLS"),$("#inactive_pool_container").show(),0==poolRotation&&TVL.comparedTo(0)>0?(poolRotation=poolList.length,loadInactivePoolList(),clearTimeout(poolTimer),poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4),refreshPoolData(!1)):loadInactivePoolList()}function checkOperatorState(){var e=0,t=Math.floor((new Date).getTime()/1e3);const o=[{to:operatorAddress,data:"0x"+contract_period_end},"latest"];ethereum.request({method:"eth_call",params:o}).then(o=>{var r=o.substring(2);new BigNumber("0x"+r.substring(0,64)).comparedTo(t)<=0&&(e=1),0!=e?1==e&&($("#pool_action").html("START NEW REWARD WEEK >"),"none"==$("#pool_action").css("display")&&$("#pool_action").fadeIn(1e3)):"none"!=$("#pool_action").css("display")&&$("#pool_action").fadeOut(1e3)}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function performOperatorAction(){var e=$("#pool_action").html().toLowerCase();0!=e.length&&sendETHTransaction(e.indexOf("rebalance")>-1?[{to:operatorAddress,from:userAddress,data:"0x"+contract_rebalance_pools}]:[{to:operatorAddress,from:userAddress,data:"0x"+contract_mint_week}],function(){$("#pool_action").fadeOut(1e3)})}function getPrices(){var e=!1;0==poolList.length&&(e=!0,loadPoolList());$.get("https://api.coingecko.com/api/v3/simple/price?ids=ethereum,bitcoin,empty-set-dollar,dynamic-set-dollar,mith-cash,basis-cash&vs_currencies=usd",function(t){if(t){ethPrice=new BigNumber(t.ethereum.usd),btcPrice=new BigNumber(t.bitcoin.usd);for(var o=new BigNumber(t["empty-set-dollar"].usd),r=new BigNumber(t["dynamic-set-dollar"].usd),s=new BigNumber(t["basis-cash"].usd),n=new BigNumber(t["mith-cash"].usd),a=o.plus(r).div(2),i=s.plus(n).div(2),l=0;l<poolList.length;l++)"zs-BTC"==poolList[l].units?poolList[l].usdPrice=btcPrice:"zs-SGR"==poolList[l].units?poolList[l].usdPrice=a:"zs-BMSGR"==poolList[l].units?poolList[l].usdPrice=i:"zs-ETH"==poolList[l].units&&(poolList[l].usdPrice=ethPrice);1==e&&(refreshPoolData(!0),refreshTreasuryData())}})}function getStablecoinPrices(e){if(0==stablesPriceList.length&&loadStablesList(),0==stablesPriceList.length)return;var t=padleftzero(stablesPriceList[e].poolToken.substring(2),64);const o=[{to:oracleAddress,data:"0x"+contract_getPrice+t},"latest"];ethereum.request({method:"eth_call",params:o}).then(t=>{var o=t.substring(2),r=new BigNumber("0x"+o.substring(0,64));r=r.div(new BigNumber(10).pow(18)),$("#price_panel_"+e).html("$"+r.toFormat(2)),++e<stablesPriceList.length?getStablecoinPrices(e):$("#price_div").css("visibility","visible")}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function getCirculatingSupply(){const e=[{to:treasuryAddress,data:"0x"+contract_circsupply},"latest"];ethereum.request({method:"eth_call",params:e}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64)).div(new BigNumber(10).pow(18));circulatingSupply=o,$("#circ_supply").html(o.toFormat(2))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function calculateUnderlyingInterest(e){var t=poolList[e].underlyingInterestMethod,o=poolList[e].underlyingInterestData,r=poolList[e].panel;if("aave"==t){const e=[{to:"0x3dfd23A6c5E8BbcFc9581d2E864a68feb6a076d3",data:"0xc540148e"+padleftzero(o.substring(2),64)},"latest"];ethereum.request({method:"eth_call",params:e}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64));o=o.div(new BigNumber(10).pow(25)),$("#panel_"+r+"_interest_link").html(o.dp(2).toString(10)+"% &#9654;")}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}else if("strategy"==t){var s=new BigNumber(o),n=poolList[e].poolToken;ethereum.request({method:"eth_blockNumber",params:[]}).then(e=>{var t,o=e.substring(2),a=new BigNumber("0x"+o.substring(0,64));t=[{to:n,data:"0x"+contract_tokenprice},"0x"+a.toString(16)],ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64)),n=new BigNumber(10).pow(18),i=o.div(n).minus(1),l=a.minus(s).div(6527);0==l.comparedTo(0)&&(l=new BigNumber(1));var c=i.div(l).times(100).times(365);c.comparedTo(.001)>0?$("#panel_"+r+"_interest_link").html(c.dp(2).toString(10)+"% &#9654;"):$("#panel_"+r+"_interest_link").html("N/A &#9654;")}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}else"none"==t&&$("#panel_"+r+"_interest_link").html("0% &#9654;")}function refreshTreasuryData(){if(0==treasuryList.length&&loadTreasuryTokens(),window.setTimeout(refreshTreasuryData,6e4),"none"==$("#treasury_action_buttons").css("display")&&"none"==$("#treasury_unlock_button").css("display")||1==$("#treasury_unlock_inner_button").prop("disabled")){poolList[poolRotation].poolToken;var e=padleftzero(userAddress.substring(2),64),t=padleftzero(treasuryAddress.substring(2),64);const o=[{to:stbzAddress,data:"0x"+contract_viewallowance+e+t},"latest"];ethereum.request({method:"eth_call",params:o}).then(e=>{var t=e.substring(2);new BigNumber("0x"+t.substring(0,64)).comparedTo(1)<0?$("#treasury_unlock_button").show():($("#treasury_unlock_button").hide(),$("#treasury_action_buttons").show())}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}$("#treasury_title").html("<big>TREASURY BALANCE</big>"),totalTreasury=new BigNumber(0);for(var o=0;o<treasuryList.length;o++)!function(e){window.setTimeout(function(){loadTreasuryToken(e)},300*e)}(o)}function loadTreasuryToken(e){var t=e,o=new BigNumber(treasuryList[t].tokenID).toString(16);o=padleftzero(o,64);const r=[{to:treasuryAddress,data:"0x"+contract_treasuryBalance+o},"latest"];ethereum.request({method:"eth_call",params:r}).then(e=>{var o=e.substring(2),r=new BigNumber("0x"+o.substring(0,64));if(r=r.div(new BigNumber(10).pow(treasuryList[t].decimals)),treasuryList[t].lastBalance=r,1==treasuryList[t].isStable&&(totalTreasury=totalTreasury.plus(r)),r.comparedTo(0)>0){var s=3;if(0==treasuryList[t].isStable&&(s=8),$("#treasury_line_"+treasuryList[t].units).length)$("#treasury_line_"+treasuryList[t].units).html(r.dp(s).toString(10)+" "+treasuryList[t].units);else{var n='<div class="right_item" style="width: 100%; color: rgb(40,200,40); text-align: center;" id="treasury_line_'+treasuryList[t].units+'">'+r.dp(s).toString(10)+" "+treasuryList[t].units+"</div>";$("#treasury_contents").append(n),"none"==$("#treasury_view").css("display")&&($("#treasury_placeholder").hide(),$("#treasury_view").show())}}else $("#treasury_line_"+treasuryList[t].units).length&&($("#treasury_line_"+treasuryList[t].units).remove(),0==$("#treasury_contents").children().length&&($("#treasury_view").hide(),$("#treasury_placeholder").show()));t==treasuryList.length-1&&personalizeTreasury()}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function personalizeTreasury(){if(!(circulatingSupply.comparedTo(0)<=0)&&"none"!=$("#treasury_view").css("display")){var e=new BigNumber($("#treasury_amount").val());if(!e.isNaN())if(e.comparedTo(0)>0){if(e.comparedTo(circulatingSupply)>0)return;var t=e.div(circulatingSupply);$("#treasury_title").html("<big>TREASURY CLAIMABLE: "+t.times(100).dp(2).toString(10)+"%</big>");for(var o=0;o<treasuryList.length;o++){var r=3;0==treasuryList[o].isStable&&(r=8),$("#treasury_line_"+treasuryList[o].units).length&&$("#treasury_line_"+treasuryList[o].units).html(treasuryList[o].lastBalance.times(t).dp(r).toString(10)+" "+treasuryList[o].units)}}else{$("#treasury_title").html("<big>TREASURY BALANCE</big>");for(o=0;o<treasuryList.length;o++){r=3;0==treasuryList[o].isStable&&(r=8),$("#treasury_line_"+treasuryList[o].units).length&&$("#treasury_line_"+treasuryList[o].units).html(treasuryList[o].lastBalance.dp(r).toString(10)+" "+treasuryList[o].units)}}}}async function refreshPoolData(e){if(0==poolRotation)checkOperatorState(),getCirculatingSupply(),TVL=new BigNumber(0),null!=poolTimer&&clearTimeout(poolTimer),poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4);else if(1==e)return null!=poolTimer&&clearTimeout(poolTimer),void(poolTimer=window.setTimeout(function(){refreshPoolData(!0)},6e4));var t=poolList[poolRotation].panel;if("none"==$("#panel_"+t+"_action_buttons").css("display")&&"none"==$("#panel_"+t+"_unlock_button").css("display")||1==$("#panel_"+t+"_unlock_inner_button").prop("disabled")){var o=poolList[poolRotation].poolToken,r=padleftzero(userAddress.substring(2),64),s=padleftzero(operatorAddress.substring(2),64);1==poolList[poolRotation].stbzPool&&(s=padleftzero(stakingAddress.substring(2),64));const e=[{to:o,data:"0x"+contract_viewallowance+r+s},"latest"];ethereum.request({method:"eth_call",params:e}).then(e=>{var o=e.substring(2);new BigNumber("0x"+o.substring(0,64)).comparedTo(1)<0?$("#panel_"+t+"_unlock_button").show():($("#panel_"+t+"_unlock_button").hide(),$("#panel_"+t+"_action_buttons").show())}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}var n,a,i,l=poolRotation;if(0==poolList[l].stbzPool){var c=new BigNumber(poolList[l].poolID).toString(16);c=padleftzero(c,64),n=[{to:operatorAddress,data:"0x"+contract_poolSize+c},"latest"]}else n=[{to:stakingAddress,data:"0x"+contract_staking_poolSize},"latest"];await ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2);a=(a=new BigNumber("0x"+o.substring(0,64))).div(new BigNumber(10).pow(poolList[l].decimals)),i=2,a.comparedTo(.01)<0&&(i=8),$("#panel_"+t+"_poolsize").html(a.dp(i).toString(10)+" "+poolList[l].units)}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))});var u;r=padleftzero(userAddress.substring(2),64);n=0==poolList[l].stbzPool?[{to:operatorAddress,data:"0x"+contract_poolBalance+c+r},"latest"]:[{to:stakingAddress,data:"0x"+contract_staking_poolBalance+r},"latest"],await ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2);u=(u=new BigNumber("0x"+o.substring(0,64))).div(new BigNumber(10).pow(poolList[l].decimals)),$("#panel_"+t+"_mybalance").html(u.dp(i).toString(10)+" "+poolList[l].units),u.comparedTo(0)<=0?"none"!=$("#panel_"+t+"_withdraw_button").css("display")&&($("#panel_"+t+"_withdraw_button").hide(),$("#panel_"+t+"_claim_button").hide()):"none"==$("#panel_"+t+"_withdraw_button").css("display")&&($("#panel_"+t+"_withdraw_button").show(),$("#panel_"+t+"_claim_button").show())}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),1==poolList[l].proxy&&(n=[{to:poolList[l].poolToken,data:"0x"+contract_tokenprice},"latest"],await ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2),r=new BigNumber("0x"+o.substring(0,64));r=r.div(new BigNumber(10).pow(18));var s=u.times(r);$("#panel_"+t+"_value").html(s.dp(i).toString(10)+" "+poolList[l].underlyingUnits);var n=a.times(r).times(poolList[l].usdPrice);console.log("Pool "+l+" usd value: "+n.dp(2).toString(10)),TVL=TVL.plus(n),(l+1>=poolList.length||0==l)&&$("#tvl").html("$"+TVL.toFormat(2))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})),n=0==poolList[l].stbzPool?[{to:operatorAddress,data:"0x"+contract_rewardEarned+c+r},"latest"]:[{to:stakingAddress,data:"0x"+contract_staking_rewardEarned+r},"latest"],await ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2),r=new BigNumber("0x"+o.substring(0,64));r=r.div(new BigNumber(10).pow(18)),0==poolList[l].stbzPool?($("#panel_"+t+"_rewardbalance").html(r.dp(4).toString(10)+" STBZ"),n=[{to:operatorAddress,data:"0x"+contract_rewardRate+c},"latest"]):($("#panel_"+t+"_rewardbalance").html(r.dp(8).toString(10)+" WETH"),n=[{to:stakingAddress,data:"0x"+contract_staking_rewardRate},"latest"])}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}),await ethereum.request({method:"eth_call",params:n}).then(e=>{var o=e.substring(2),r=new BigNumber("0x"+o.substring(0,64));if("LP"!=poolList[l].units){r=r.div(new BigNumber(10).pow(18)),r=0==poolList[l].stbzPool?r.times(stbzPrice):r.times(ethPrice),a.comparedTo(0)>0&&(1==poolList[l].proxy&&0==(a=a.times(poolList[l].usdPrice)).comparedTo(0)&&(a=new BigNumber(1)),0==poolList[l].proxy&&0==poolList[l].stbzPool&&(console.log("Pool Normal "+l+" usd value: "+a.dp(2).toString(10)),TVL=TVL.plus(a)),r=0==poolList[l].stbzPool?r.div(a):r.div(a.times(stbzPrice)));var s=r.times(new BigNumber(86400)),n=2;(s=s.times(100)).comparedTo("0.01")<0&&(n=8),$("#panel_"+t+"_dpy").html(s.dp(n).toString(10)+"%");var i=s.times(365);$("#panel_"+t+"_apr").html(i.dp(n).toString(10)+"%");var c=i.div(100);if(c=c.div(52).plus(1).pow(52).minus(1).times(100),1==poolList[l].proxy){var u="---";$("#panel_"+t+"_interest_link").length>0&&(u=$("#panel_"+t+"_interest_link").html()),$("#panel_"+t+"_apy").html(c.dp(n).toString(10)+"% + <a id='panel_"+t+"_interest_link' href='wrap/' style='color: rgb(40,200,40);'>"+u+"</a>"),calculateUnderlyingInterest(l)}else $("#panel_"+t+"_apy").html(c.dp(n).toString(10)+"%");l+1>=poolList.length&&$("#tvl").html("$"+TVL.toFormat(2)),++poolRotation>=poolList.length?(getPrices(),poolRotation=0):window.setTimeout(function(){refreshPoolData(!1)},500)}else getLPTokenDPY(l,a,r)}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function getLPTokenDPY(e,t,o){const r=[{to:poolList[e].poolToken,data:"0x"+contract_getreserves},"latest"];ethereum.request({method:"eth_call",params:r}).then(r=>{var s=r.substring(2),n=new BigNumber("0x"+s.substring(0,64)),a=new BigNumber("0x"+s.substring(64,128));const i=[{to:poolList[e].poolToken,data:"0x"+contract_token0address},"latest"];ethereum.request({method:"eth_call",params:i}).then(r=>{var s=r.substring(2).substring(0,64).toLowerCase(),i=padleftzero(wethAddress.substring(2),64).toLowerCase();const l=[{to:poolList[e].poolToken,data:"0x"+contract_totalsupply},"latest"];ethereum.request({method:"eth_call",params:l}).then(r=>{var l=r.substring(2),c=new BigNumber("0x"+l.substring(0,64));if(!(c.comparedTo(0)<=0||ethPrice.comparedTo(0)<=0)){var u=0;s==i?(n=n.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=n.div(a.div(new BigNumber(10).pow(18))),$("#stbz_price").html("$"+stbzPrice.toFormat(2))),a=new BigNumber(n)):(a=a.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=a.div(n.div(new BigNumber(10).pow(18))),$("#stbz_price").html("$"+stbzPrice.toFormat(2))),n=new BigNumber(a)),u=n.plus(a),c=c.div(new BigNumber(10).pow(18));var d=t.div(c),p=u.times(d);p.comparedTo(0)<=0?p=1:(console.log("LP Pool usd value: "+p.dp(2).toString(10)),TVL=TVL.plus(p));var g=(o=(o=(o=o.div(new BigNumber(10).pow(18))).times(stbzPrice)).div(p)).times(new BigNumber(86400));g=g.times(100),$("#panel_"+poolList[e].panel+"_dpy").html(g.dp(2).toString(10)+"%");var m=g.times(365);$("#panel_"+poolList[e].panel+"_apr").html(m.dp(2).toString(10)+"%");var b=m.div(100);b=b.div(52).plus(1).pow(52).minus(1).times(100),$("#panel_"+poolList[e].panel+"_apy").html(b.dp(2).toString(10)+"%"),e+1>=poolList.length&&$("#tvl").html("$"+TVL.toFormat(2)),++poolRotation>=poolList.length?(getPrices(),poolRotation=0):window.setTimeout(function(){refreshPoolData(!1)},500)}}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function unlockToken(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber(2).pow(256).minus(1),s=operatorAddress.substring(2);1==poolList[t].stbzPool&&(s=stakingAddress.substring(2)),s=padleftzero(s.toLowerCase(),64);var n=r.toString(16);n=padleftzero(n,64),sendETHTransaction([{to:poolList[t].poolToken,gas:"0x186A0",from:userAddress,data:"0x"+contract_approve+s+n}],function(){$("#panel_"+e+"_unlock_inner_button").prop("disabled",!0),$("#panel_"+e+"_unlock_inner_button").html("UNLOCKING "+poolList[t].units)})}function unlockTreasury(){var e=new BigNumber(2).pow(256).minus(1),t=treasuryAddress.substring(2);t=padleftzero(t,64);var o=e.toString(16);o=padleftzero(o,64),sendETHTransaction([{to:stbzAddress,gas:"0x186A0",from:userAddress,data:"0x"+contract_approve+t+o}],function(){$("#treasury_unlock_inner_button").prop("disabled",!0),$("#treasury_unlock_inner_button").html("UNLOCKING TREASURY")})}function selectMaxTreasury(){var e=padleftzero(userAddress.substring(2),64);const t=[{to:stbzAddress,data:"0x"+contract_balanceof+e},"latest"];ethereum.request({method:"eth_call",params:t}).then(e=>{var t=e.substring(2),o=new BigNumber("0x"+t.substring(0,64));o=o.div(new BigNumber(10).pow(18)),$("#treasury_amount").val(o.toString(10)),personalizeTreasury()}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function selectMaxOut(e){for(var t,o=0,r=0;r<poolList.length;r++)if(parseInt(poolList[r].panel)==e){o=r;break}if(0==poolList[o].stbzPool){var s=new BigNumber(poolList[o].poolID).toString(16);s=padleftzero(s,64);var n=padleftzero(userAddress.substring(2),64);t=[{to:operatorAddress,data:"0x"+contract_poolBalance+s+n},"latest"]}else{n=padleftzero(userAddress.substring(2),64);t=[{to:stakingAddress,data:"0x"+contract_staking_poolBalance+n},"latest"]}ethereum.request({method:"eth_call",params:t}).then(t=>{var r=t.substring(2),s=new BigNumber("0x"+r.substring(0,64));s=s.div(new BigNumber(10).pow(poolList[o].decimals)),$("#panel_"+e+"_amount").val(s.toString(10))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function selectMaxIn(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=padleftzero(userAddress.substring(2),64);const s=[{to:poolList[t].poolToken,data:"0x"+contract_balanceof+r},"latest"];ethereum.request({method:"eth_call",params:s}).then(o=>{var r=o.substring(2),s=new BigNumber("0x"+r.substring(0,64));s=s.div(new BigNumber(10).pow(poolList[t].decimals)),$("#panel_"+e+"_amount").val(s.toString(10))}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))})}function deposit(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber($("#panel_"+e+"_amount").val());if(!(r.isNaN()||r.comparedTo(0)<=0)){var s,n=(r=r.times(new BigNumber(10).pow(poolList[t].decimals))).toString(16);if(n=padleftzero(n,64),0==poolList[t].stbzPool){var a=new BigNumber(poolList[t].poolID).toString(16);a=padleftzero(a,64),s=[{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_deposit+a+n}]}else s=[{to:stakingAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_staking_deposit+n}];sendETHTransaction(s,null)}}function withdraw(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber($("#panel_"+e+"_amount").val());if(!(r.isNaN()||r.comparedTo(0)<=0)){var s,n=(r=r.times(new BigNumber(10).pow(poolList[t].decimals))).toString(16);if(n=padleftzero(n,64),0==poolList[t].stbzPool){var a=new BigNumber(poolList[t].poolID).toString(16);a=padleftzero(a,64),s=[{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_exit+a+n}]}else s=[{to:stakingAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_staking_exit+n}];sendETHTransaction(s,null)}}function claimTreasury(){var e=new BigNumber($("#treasury_amount").val());if(e.isNaN())return;if(e.comparedTo(0)<=0)return;if(e.comparedTo(circulatingSupply)>0)return;var t=e.div(circulatingSupply);if(e.times(stbzPrice).comparedTo(totalTreasury.times(t))>0&&0==confirm("This burn is likely not economic, do you want to continue?"))return;var o=(e=e.times(new BigNumber(10).pow(18))).toString(16);o=padleftzero(o,64),sendETHTransaction([{to:treasuryAddress,gas:"0x927C0",from:userAddress,data:"0x"+contract_claimTreasury+o}],null)}function claimReward(e){for(var t=0,o=0;o<poolList.length;o++)if(parseInt(poolList[o].panel)==e){t=o;break}var r=new BigNumber(poolList[t].poolID).toString(16);r=padleftzero(r,64),sendETHTransaction(0==poolList[t].stbzPool?[{to:operatorAddress,gas:"0x30D40",from:userAddress,data:"0x"+contract_claimReward+r}]:[{to:stakingAddress,gas:"0x30D40",from:userAddress,data:"0x"+contract_staking_claimReward}],null)}function sendETHTransaction(e,t){0==new BigNumber("0x"+ethereum.chainId.substring(2)).comparedTo(targetNetwork)?ethereum.request({method:"eth_sendTransaction",params:e}).then(e=>{console.log("Transaction hash: "+e),t&&t()}).catch(e=>{console.log("An error occurred while pinging blockchain: "+JSON.stringify(e))}):alert("This application requires the main network, please switch it in your MetaMask UI.")}function setCookie(e,t,o){var r="";if(o>0){var s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3),r="; expires="+s.toUTCString()}document.cookie=e+"="+(t||"")+r+"; path=/; SameSite=Strict"}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var s=o[r];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null}function eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}$(window).on("load",function(){checkMetaMaskExist()});