var detectMetamask=!1,metamaskConnected=!1,userAddress="",stbzPrice=0,ethPrice=new BigNumber(0),circulatingSupply=new BigNumber(0),TVL=new BigNumber(0),totalTreasury=new BigNumber(0),operatorAddress="0xEe9156C93ebB836513968F92B4A67721f3cEa08a",wethAddress="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",stbzAddress="0xB987D48Ed8f2C468D52D6405624EADBa5e76d723",oracleAddress="0x438462BF1B159c64C05d795b5589435f318c25fC",treasuryAddress="0x42Cbe17335ef8d52F8d1e0a261eA2e78E829C56e",contract_viewallowance="dd62ed3e",contract_approve="095ea7b3",contract_totalsupply="18160ddd",contract_balanceof="70a08231",contract_getreserves="0902f1ac",contract_token0address="0dfe1681",contract_tokenprice="7b1b1de6",contract_deposit="e2bbb158",contract_exit="2af9cc41",contract_claimReward="1c4b774b",contract_poolBalance="351e7cb3",contract_poolSize="dd034779",contract_rewardEarned="cdfa2c36",contract_rewardRate="cea01962",contract_circsupply="9358928b",contract_claimTreasury="379607f5",contract_treasuryBalance="9105d748",contract_getPrice="41976e09",targetNetwork=1,poolList=[],treasuryList=[],poolRotation=0;function loadPoolList(){poolList.push({poolID:0,poolToken:"0xdb28312a8d26d59978d9b86ca185707b1a26725b",units:"LP",decimals:18,panel:"0",proxy:!1}),poolList.push({poolID:1,poolToken:"0x6B175474E89094C44Da98b954EedeAC495271d0F",units:"DAI",decimals:18,panel:"1",proxy:!1}),poolList.push({poolID:2,poolToken:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",units:"USDC",decimals:6,panel:"2",proxy:!1}),poolList.push({poolID:3,poolToken:"0xdAC17F958D2ee523a2206206994597C13D831ec7",units:"USDT",decimals:6,panel:"3",proxy:!1}),poolList.push({poolID:4,poolToken:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51",units:"sUSD",decimals:18,panel:"4",proxy:!1}),poolList.push({poolID:5,poolToken:"0x8d600F091fae664B1c4Daa3A341737e976426920",units:"za-USDC",decimals:6,panel:"5",proxy:!0,underlyingUnits:"USDC"})}function loadTreasuryTokens(){treasuryList.push({token:"0x6B175474E89094C44Da98b954EedeAC495271d0F",units:"DAI",decimals:18,tokenID:0,lastBalance:0}),treasuryList.push({token:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",units:"USDC",decimals:6,tokenID:1,lastBalance:0}),treasuryList.push({token:"0xdAC17F958D2ee523a2206206994597C13D831ec7",units:"USDT",decimals:6,tokenID:2,lastBalance:0}),treasuryList.push({token:"0x57Ab1ec28D129707052df4dF418D58a2D46d5f51",units:"sUSD",decimals:18,tokenID:3,lastBalance:0}),$("#treasury_amount").on("change keyup paste",personalizeTreasury)}function checkMetaMaskExist(){void 0!==window.ethereum&&(1==ethereum.isMetaMask&&(detectMetamask=!0,null==getCookie("metamask")?$("#metamask_interactive").html("Connect MetaMask"):0==metamaskConnected&&enableMetaMask()))}async function enableMetaMask(){const e=await ethereum.request({method:"eth_requestAccounts"});if(e){if(ethereum.chainId||(ethereum.chainId="0x1"),0!=new BigNumber("0x"+ethereum.chainId.substring(2)).comparedTo(targetNetwork))return void alert("This application requires the main network, please switch it in your MetaMask UI.");userAddress=e[0],metamaskConnected=!0,setCookie("metamask","active",0),$("#data_panel").length?($("#loading_panel").hide(),$("#data_panel").show(),getEtherPrice()):getStablecoinPrices(1),$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),ethereum.on("accountsChanged",function(e){userAddress=e[0],$("#metamask_interactive").html(userAddress.substring(0,9)+"..."+userAddress.substring(33)),location.reload()}),ethereum.on("chainChanged",function(e){location.reload()})}}function metamaskButtonClick(){if(0==detectMetamask)window.open("https://metamask.io/","_blank");else 1==detectMetamask&&0==metamaskConnected&&enableMetaMask()}function padleftzero(e,r){return(e=e.toString()).length<r?padleftzero("0"+e,r):e}function padrightzero(e,r){return(e=e.toString()).length<r?padrightzero(e+"0",r):e}function getEtherPrice(){$.get("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd",function(e){e&&(ethPrice=new BigNumber(e.ethereum.usd),0==poolList.length&&(refreshPoolData(),refreshTreasuryData()))})}function getStablecoinPrices(e){if(0==poolList.length&&loadPoolList(),0==poolList.length)return;var r=padleftzero(poolList[e].poolToken.substring(2),64);const t=[{to:oracleAddress,data:"0x"+contract_getPrice+r},"latest"];ethereum.sendAsync({method:"eth_call",params:t,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),s=new BigNumber("0x"+o.substring(0,64));s=s.div(new BigNumber(10).pow(18)),$("#price_panel_"+e).html("$"+s.toFormat(2)),++e<poolList.length?getStablecoinPrices(e):$("#price_div").css("visibility","visible")}})}function getCirculatingSupply(){const e=[{to:treasuryAddress,data:"0x"+contract_circsupply},"latest"];ethereum.sendAsync({method:"eth_call",params:e,id:"1",jsonrpc:"2.0"},function(e,r){if(e)console.log("An error occurred while pinging blockchain");else if(r.error)console.log("RPC error: "+r.error);else{var t=r.result.substring(2),o=new BigNumber("0x"+t.substring(0,64)).div(new BigNumber(10).pow(18));circulatingSupply=o,$("#circ_supply").html(o.toFormat(2))}})}function refreshTreasuryData(){if(0==treasuryList.length&&loadTreasuryTokens(),window.setTimeout(refreshTreasuryData,6e4),"none"==$("#treasury_action_buttons").css("display")&&"none"==$("#treasury_unlock_button").css("display")||1==$("#treasury_unlock_inner_button").prop("disabled")){poolList[poolRotation].poolToken;var e=padleftzero(userAddress.substring(2),64),r=padleftzero(treasuryAddress.substring(2),64);const t=[{to:stbzAddress,data:"0x"+contract_viewallowance+e+r},"latest"];ethereum.sendAsync({method:"eth_call",params:t,id:"1",jsonrpc:"2.0"},function(e,r){if(e)console.log("An error occurred while pinging blockchain");else if(r.error)console.log("RPC error: "+r.error);else{var t=r.result.substring(2);new BigNumber("0x"+t.substring(0,64)).comparedTo(1)<0?$("#treasury_unlock_button").show():($("#treasury_unlock_button").hide(),$("#treasury_action_buttons").show())}})}$("#treasury_title").html("<big>TREASURY BALANCE</big>"),totalTreasury=new BigNumber(0);for(var t=0;t<treasuryList.length;t++)!function(e){var r=t,o=new BigNumber(treasuryList[r].tokenID).toString(16);o=padleftzero(o,64);const s=[{to:treasuryAddress,data:"0x"+contract_treasuryBalance+o},"latest"];ethereum.sendAsync({method:"eth_call",params:s,id:"1",jsonrpc:"2.0"},function(e,t){if(e)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),s=new BigNumber("0x"+o.substring(0,64));if(s=s.div(new BigNumber(10).pow(treasuryList[r].decimals)),treasuryList[r].lastBalance=s,totalTreasury=totalTreasury.plus(s),s.comparedTo(0)>0)if($("#treasury_line_"+treasuryList[r].units).length)$("#treasury_line_"+treasuryList[r].units).html(s.dp(3).toString(10)+" "+treasuryList[r].units);else{var n='<div class="right_item" style="width: 100%; color: rgb(40,200,40); text-align: center;" id="treasury_line_'+treasuryList[r].units+'">'+s.dp(3).toString(10)+" "+treasuryList[r].units+"</div>";$("#treasury_contents").append(n),"none"==$("#treasury_view").css("display")&&($("#treasury_placeholder").hide(),$("#treasury_view").show())}else $("#treasury_line_"+treasuryList[r].units).length&&($("#treasury_line_"+treasuryList[r].units).remove(),0==$("#treasury_contents").children().length&&($("#treasury_view").hide(),$("#treasury_placeholder").show()));r==treasuryList.length-1&&personalizeTreasury()}})}()}function personalizeTreasury(){if(!(circulatingSupply.comparedTo(0)<=0)&&"none"!=$("#treasury_view").css("display")){var e=new BigNumber($("#treasury_amount").val());if(e.comparedTo(0)>0){if(e.comparedTo(circulatingSupply)>0)return;var r=e.div(circulatingSupply);$("#treasury_title").html("<big>TREASURY CLAIMABLE: "+r.times(100).dp(2).toString(10)+"%</big>");for(var t=0;t<treasuryList.length;t++)$("#treasury_line_"+treasuryList[t].units).length&&$("#treasury_line_"+treasuryList[t].units).html(treasuryList[t].lastBalance.times(r).dp(3).toString(10)+" "+treasuryList[t].units)}else{$("#treasury_title").html("<big>TREASURY BALANCE</big>");for(t=0;t<treasuryList.length;t++)$("#treasury_line_"+treasuryList[t].units).length&&$("#treasury_line_"+treasuryList[t].units).html(treasuryList[t].lastBalance.dp(3).toString(10)+" "+treasuryList[t].units)}}}function refreshPoolData(){0==poolList.length&&loadPoolList();var e=poolList[poolRotation].panel;if(0==poolRotation&&(getCirculatingSupply(),TVL=new BigNumber(0),window.setTimeout(refreshPoolData,6e4)),"none"==$("#panel_"+e+"_action_buttons").css("display")&&"none"==$("#panel_"+e+"_unlock_button").css("display")||1==$("#panel_"+e+"_unlock_inner_button").prop("disabled")){var r=poolList[poolRotation].poolToken,t=padleftzero(userAddress.substring(2),64),o=padleftzero(operatorAddress.substring(2),64);const s=[{to:r,data:"0x"+contract_viewallowance+t+o},"latest"];ethereum.sendAsync({method:"eth_call",params:s,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2);new BigNumber("0x"+o.substring(0,64)).comparedTo(1)<0?$("#panel_"+e+"_unlock_button").show():($("#panel_"+e+"_unlock_button").hide(),$("#panel_"+e+"_action_buttons").show())}})}var s=new BigNumber(poolList[poolRotation].poolID).toString(16);s=padleftzero(s,64);var n=poolRotation;const a=[{to:operatorAddress,data:"0x"+contract_poolSize+s},"latest"];ethereum.sendAsync({method:"eth_call",params:a,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),a=new BigNumber("0x"+o.substring(0,64));a=a.div(new BigNumber(10).pow(poolList[n].decimals)),$("#panel_"+e+"_poolsize").html(a.dp(2).toString(10)+" "+poolList[n].units);var i=padleftzero(userAddress.substring(2),64);const r=[{to:operatorAddress,data:"0x"+contract_poolBalance+s+i},"latest"];ethereum.sendAsync({method:"eth_call",params:r,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),l=new BigNumber("0x"+o.substring(0,64));if(l=l.div(new BigNumber(10).pow(poolList[n].decimals)),$("#panel_"+e+"_mybalance").html(l.dp(8).toString(10)+" "+poolList[n].units),l.comparedTo(0)<=0?"none"!=$("#panel_"+e+"_withdraw_button").css("display")&&($("#panel_"+e+"_withdraw_button").hide(),$("#panel_"+e+"_claim_button").hide()):"none"==$("#panel_"+e+"_withdraw_button").css("display")&&($("#panel_"+e+"_withdraw_button").show(),$("#panel_"+e+"_claim_button").show()),1==poolList[n].proxy){const r=[{to:poolList[n].poolToken,data:"0x"+contract_tokenprice},"latest"];ethereum.sendAsync({method:"eth_call",params:r,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),s=new BigNumber("0x"+o.substring(0,64));s=s.div(new BigNumber(10).pow(18));var i=l.times(s);$("#panel_"+e+"_value").html(i.dp(3).toString(10)+" "+poolList[n].underlyingUnits),TVL=TVL.plus(a.times(s)),(n+1>=poolList.length||0==n)&&$("#tvl").html("$"+TVL.toFormat(2))}})}const r=[{to:operatorAddress,data:"0x"+contract_rewardEarned+s+i},"latest"];ethereum.sendAsync({method:"eth_call",params:r,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),i=new BigNumber("0x"+o.substring(0,64));i=i.div(new BigNumber(10).pow(18)),$("#panel_"+e+"_rewardbalance").html(i.dp(4).toString(10)+" STBZ");const r=[{to:operatorAddress,data:"0x"+contract_rewardRate+s},"latest"];ethereum.sendAsync({method:"eth_call",params:r,id:"1",jsonrpc:"2.0"},function(r,t){if(r)console.log("An error occurred while pinging blockchain");else if(t.error)console.log("RPC error: "+t.error);else{var o=t.result.substring(2),s=new BigNumber("0x"+o.substring(0,64));if("LP"!=poolList[n].units){s=(s=s.div(new BigNumber(10).pow(18))).times(stbzPrice),a.comparedTo(0)>0&&(0==poolList[n].proxy&&(TVL=TVL.plus(a)),s=s.div(a));var i=s.times(new BigNumber(86400));i=i.times(100),$("#panel_"+e+"_dpy").html(i.dp(2).toString(10)+"%");var l=i.times(365);$("#panel_"+e+"_apr").html(l.dp(2).toString(10)+"%"),n+1>=poolList.length&&$("#tvl").html("$"+TVL.toFormat(2))}else getLPTokenDPY(n,a,s);++poolRotation>=poolList.length?(getEtherPrice(),poolRotation=0):window.setTimeout(refreshPoolData,500)}})}})}})}})}function getLPTokenDPY(e,r,t){const o=[{to:poolList[e].poolToken,data:"0x"+contract_getreserves},"latest"];ethereum.sendAsync({method:"eth_call",params:o,id:"1",jsonrpc:"2.0"},function(o,s){if(o)console.log("An error occurred while pinging blockchain");else if(s.error)console.log("RPC error: "+s.error);else{var n=s.result.substring(2),a=new BigNumber("0x"+n.substring(0,64)),i=new BigNumber("0x"+n.substring(64,128));const o=[{to:poolList[e].poolToken,data:"0x"+contract_token0address},"latest"];ethereum.sendAsync({method:"eth_call",params:o,id:"1",jsonrpc:"2.0"},function(o,s){if(o)console.log("An error occurred while pinging blockchain");else if(s.error)console.log("RPC error: "+s.error);else{var n=s.result.substring(2).substring(0,64).toLowerCase(),l=padleftzero(wethAddress.substring(2),64).toLowerCase();const o=[{to:poolList[e].poolToken,data:"0x"+contract_totalsupply},"latest"];ethereum.sendAsync({method:"eth_call",params:o,id:"1",jsonrpc:"2.0"},function(o,s){if(o)console.log("An error occurred while pinging blockchain");else if(s.error)console.log("RPC error: "+s.error);else{var c=s.result.substring(2),u=new BigNumber("0x"+c.substring(0,64));if(u.comparedTo(0)<=0)return;if(ethPrice.comparedTo(0)<=0)return;var d=0;n==l?(a=a.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=a.div(i.div(new BigNumber(10).pow(18)))),i=new BigNumber(a)):(i=i.div(new BigNumber(10).pow(18)).times(ethPrice),0==e&&(stbzPrice=i.div(a.div(new BigNumber(10).pow(18)))),a=new BigNumber(i)),d=a.plus(i),u=u.div(new BigNumber(10).pow(18));var p=r.div(u),g=d.times(p);g.comparedTo(0)<=0?g=1:TVL=TVL.plus(g);var m=(t=(t=(t=t.div(new BigNumber(10).pow(18))).times(stbzPrice)).div(g)).times(new BigNumber(86400));m=m.times(100),$("#panel_"+poolList[e].panel+"_dpy").html(m.dp(2).toString(10)+"%");var h=m.times(365);$("#panel_"+poolList[e].panel+"_apr").html(h.dp(2).toString(10)+"%"),e+1>=poolList.length&&$("#tvl").html("$"+TVL.toFormat(2))}})}})}})}function unlockToken(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=new BigNumber(2).pow(256).minus(1),s=operatorAddress.substring(2);s=padleftzero(s,64);var n=o.toString(16);n=padleftzero(n,64),sendETHTransaction([{to:poolList[r].poolToken,gas:"0x186A0",from:userAddress,data:"0x"+contract_approve+s+n}],function(){$("#panel_"+e+"_unlock_inner_button").prop("disabled",!0),$("#panel_"+e+"_unlock_inner_button").html("UNLOCKING "+poolList[r].units)})}function unlockTreasury(){var e=new BigNumber(2).pow(256).minus(1),r=treasuryAddress.substring(2);r=padleftzero(r,64);var t=e.toString(16);t=padleftzero(t,64),sendETHTransaction([{to:stbzAddress,gas:"0x186A0",from:userAddress,data:"0x"+contract_approve+r+t}],function(){$("#treasury_unlock_inner_button").prop("disabled",!0),$("#treasury_unlock_inner_button").html("UNLOCKING TREASURY")})}function selectMaxTreasury(){var e=padleftzero(userAddress.substring(2),64);const r=[{to:stbzAddress,data:"0x"+contract_balanceof+e},"latest"];ethereum.sendAsync({method:"eth_call",params:r,id:"1",jsonrpc:"2.0"},function(e,r){if(e)console.log("An error occurred while pinging blockchain");else if(r.error)console.log("RPC error: "+r.error);else{var t=r.result.substring(2),o=new BigNumber("0x"+t.substring(0,64));o=o.div(new BigNumber(10).pow(18)),$("#treasury_amount").val(o),personalizeTreasury()}})}function selectMaxOut(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=new BigNumber(poolList[r].poolID).toString(16);o=padleftzero(o,64);var s=padleftzero(userAddress.substring(2),64);const n=[{to:operatorAddress,data:"0x"+contract_poolBalance+o+s},"latest"];ethereum.sendAsync({method:"eth_call",params:n,id:"1",jsonrpc:"2.0"},function(t,o){if(t)console.log("An error occurred while pinging blockchain");else if(o.error)console.log("RPC error: "+o.error);else{var s=o.result.substring(2),n=new BigNumber("0x"+s.substring(0,64));n=n.div(new BigNumber(10).pow(poolList[r].decimals)),$("#panel_"+e+"_amount").val(n)}})}function selectMaxIn(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=padleftzero(userAddress.substring(2),64);const s=[{to:poolList[r].poolToken,data:"0x"+contract_balanceof+o},"latest"];ethereum.sendAsync({method:"eth_call",params:s,id:"1",jsonrpc:"2.0"},function(t,o){if(t)console.log("An error occurred while pinging blockchain");else if(o.error)console.log("RPC error: "+o.error);else{var s=o.result.substring(2),n=new BigNumber("0x"+s.substring(0,64));n=n.div(new BigNumber(10).pow(poolList[r].decimals)),$("#panel_"+e+"_amount").val(n)}})}function deposit(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=new BigNumber($("#panel_"+e+"_amount").val());if(o.comparedTo(0)<=0)return;var s=(o=o.times(new BigNumber(10).pow(poolList[r].decimals))).toString(16);s=padleftzero(s,64);var n=new BigNumber(poolList[r].poolID).toString(16);n=padleftzero(n,64),sendETHTransaction([{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_deposit+n+s}],null)}function withdraw(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=new BigNumber($("#panel_"+e+"_amount").val());if(o.comparedTo(0)<=0)return;var s=(o=o.times(new BigNumber(10).pow(poolList[r].decimals))).toString(16);s=padleftzero(s,64);var n=new BigNumber(poolList[r].poolID).toString(16);n=padleftzero(n,64),sendETHTransaction([{to:operatorAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_exit+n+s}],null)}function claimTreasury(){var e=new BigNumber($("#treasury_amount").val());if(e.comparedTo(0)<=0)return;if(e.times(stbzPrice).comparedTo(totalTreasury)>0&&0==confirm("This burn is likely not economic, do you want to continue?"))return;var r=(e=e.times(new BigNumber(10).pow(18))).toString(16);r=padleftzero(r,64),sendETHTransaction([{to:treasuryAddress,gas:"0x493E0",from:userAddress,data:"0x"+contract_claimTreasury+r}],null)}function claimReward(e){for(var r=0,t=0;t<poolList.length;t++)if(parseInt(poolList[t].panel)==e){r=t;break}var o=new BigNumber(poolList[r].poolID).toString(16);o=padleftzero(o,64),sendETHTransaction([{to:operatorAddress,gas:"0x30D40",from:userAddress,data:"0x"+contract_claimReward+o}],null)}function sendETHTransaction(e,r){0==new BigNumber("0x"+ethereum.chainId.substring(2)).comparedTo(targetNetwork)?ethereum.sendAsync({method:"eth_sendTransaction",params:e,from:userAddress},function(e,t){e?console.log("An error occurred while pinging blockchain"):t.error?console.log("RPC error: "+t.error):(console.log("Transaction hash: "+t.result),r&&r())}):alert("This application requires the main network, please switch it in your MetaMask UI.")}function setCookie(e,r,t){var o="";if(t>0){var s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3),o="; expires="+s.toUTCString()}document.cookie=e+"="+(r||"")+o+"; path=/; SameSite=Strict"}function getCookie(e){for(var r=e+"=",t=document.cookie.split(";"),o=0;o<t.length;o++){for(var s=t[o];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(r))return s.substring(r.length,s.length)}return null}function eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}$(window).on("load",function(){checkMetaMaskExist()});